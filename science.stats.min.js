function science_stats_kmeansCompare(a,b){if(!a||!b||a.length!==b.length)return!1;var c=a.length,d=-1;while(++d<c)if(a[d]!==b[d])return!1;return!0}function science_stats_kmeansRandom(a,b){var c=b.length;if(a>c)return null;var d=[],e=[],f={},g=0,h=0,i,j,k;while(h<a){if(g===c)return null;var l=Math.floor(Math.random()*c);if(l in f)continue;f[l]=1,g++,j=b[l],k=!0;for(i=0;i<h;i++)if(science_stats_kmeansCompare(j,d[i])){k=!1;break}k&&(d[h]=j,e[h]=l,h++)}return d}function calculateCentroid(a,b,c,d){var e=[],f=a+c,g=b.length,h=-1;while(++h<g)e[h]=(a*b[h]+c*d[h])/f;return e}function science_stats_loessFiniteReal(a){var b=a.length,c=-1;while(++c<b)if(!isFinite(a[c]))return!1;return!0}function science_stats_loessStrictlyIncreasing(a){var b=a.length,c=0;while(++c<b)if(a[c-1]>=a[c])return!1;return!0}function science_stats_loessTricube(a){return(a=1-a*a*a)*a*a}function science_stats_loessUpdateBandwidthInterval(a,b,c,d){var e=d[0],f=d[1],g=science_stats_loessNextNonzero(b,f);if(g<a.length&&a[g]-a[c]<a[c]-a[e]){var h=science_stats_loessNextNonzero(b,e);d[0]=h,d[1]=g}}function science_stats_loessNextNonzero(a,b){var c=b+1;while(c<a.length&&a[c]===0)c++;return c}science.stats={},science.stats.bandwidth={nrd0:function(a){var b=Math.sqrt(science.stats.variance(a));return(lo=Math.min(b,science.stats.iqr(a)/1.34))||(lo=b)||(lo=Math.abs(a[1]))||(lo=1),.9*lo*Math.pow(a.length,-0.2)},nrd:function(a){var b=science.stats.iqr(a)/1.34;return 1.06*Math.min(Math.sqrt(science.stats.variance(a)),b)*Math.pow(a.length,-0.2)}},science.stats.distance={euclidean:function(a,b){var c=a.length,d=-1,e=0,f;while(++d<c)f=a[d]-b[d],e+=f*f;return Math.sqrt(e)},manhattan:function(a,b){var c=a.length,d=-1,e=0;while(++d<c)e+=Math.abs(a[d]-b[d]);return e},minkowski:function(a){return function(b,c){var d=b.length,e=-1,f=0;while(++e<d)f+=Math.pow(Math.abs(b[e]-c[e]),a);return Math.pow(f,1/a)}},chebyshev:function(a,b){var c=a.length,d=-1,e=0,f;while(++d<c)f=Math.abs(a[d]-b[d]),f>e&&(e=f);return e},hamming:function(a,b){var c=a.length,d=-1,e=0;while(++d<c)a[d]!==b[d]&&e++;return e},jaccard:function(a,b){var c=a.length,d=-1,e=0;while(++d<c)a[d]===b[d]&&e++;return e/c},braycurtis:function(a,b){var c=a.length,d=-1,e=0,f=0,g,h;while(++d<c)g=a[d],h=b[d],e+=Math.abs(g-h),f+=Math.abs(g+h);return e/f}},science.stats.erf=function(a){var b=.254829592,c=-0.284496736,d=1.421413741,e=-1.453152027,f=1.061405429,g=.3275911,h=a<0?-1:1;a<0&&(h=-1,a=-a);var i=1/(1+g*a);return h*(1-((((f*i+e)*i+d)*i+c)*i+b)*i*Math.exp(-a*a))},science.stats.phi=function(a){return.5*(1+science.stats.erf(a/Math.SQRT2))},science.stats.kernel={uniform:function(a){return a<=1&&a>=-1?.5:0},triangular:function(a){return a<=1&&a>=-1?1-Math.abs(a):0},epanechnikov:function(a){return a<=1&&a>=-1?.75*(1-a*a):0},quartic:function(a){if(a<=1&&a>=-1){var b=1-a*a;return.9375*b*b}return 0},triweight:function(a){if(a<=1&&a>=-1){var b=1-a*a;return 35/32*b*b*b}return 0},gaussian:function(a){return 1/Math.sqrt(2*Math.PI)*Math.exp(-0.5*a*a)},cosine:function(a){return a<=1&&a>=-1?Math.PI/4*Math.cos(Math.PI/2*a):0}},science.stats.kde=function(){function d(d,e){var f=c.call(this,b);return d.map(function(c){var d=-1,e=0,g=b.length;while(++d<g)e+=a((c-b[d])/f);return[c,e/f/g]})}var a=science.stats.kernel.gaussian,b=[],c=science.stats.bandwidth.nrd;return d.kernel=function(b){return arguments.length?(a=b,d):a},d.sample=function(a){return arguments.length?(b=a,d):b},d.bandwidth=function(a){return arguments.length?(c=science.functor(a),d):c},d},science.stats.kmeans=function(){function d(d){var e=d.length,f=[],g=[],h=1,i=0,j=science_stats_kmeansRandom(c,d),l,m,n,o,p,q,r;while(h&&i<b){n=-1;while(++n<c)g[n]=0;m=-1;while(++m<e){o=d[m],q=Infinity,n=-1;while(++n<c)p=a.call(this,j[n],o),p<q&&(q=p,r=n);g[f[m]=r]++}l=[],m=-1;while(++m<e){o=f[m],p=l[o];if(p==null)l[o]=d[m].slice();else{n=-1;while(++n<p.length)p[n]+=d[m][n]}}n=-1;while(++n<c){o=l[n],p=1/g[n],m=-1;while(++m<o.length)o[m]*=p}h=0,n=-1;while(++n<c)if(!science_stats_kmeansCompare(l[n],j[n])){h=1;break}j=l,i++}return{assignments:f,centroids:j}}var a=science.stats.distance.euclidean,b=1e3,c=1;return d.k=function(a){return arguments.length?(c=a,d):c},d.distance=function(b){return arguments.length?(a=b,d):a},d},science.stats.hcluster=function(){function c(c){var d=c.length,e=[],f=[],g=[],h=[],i,j,k,l,m,n,o,p;o=-1;while(++o<d){e[o]=0,g[o]=[],p=-1;while(++p<d)g[o][p]=o===p?Infinity:a(c[o],c[p]),g[o][e[o]]>g[o][p]&&(e[o]=p)}o=-1;while(++o<d)h[o]=[],h[o][0]={left:null,right:null,dist:0,centroid:c[o],size:1,depth:0},f[o]=1;for(m=0;m<d-1;m++){i=0;for(o=0;o<d;o++)g[o][e[o]]<g[i][e[i]]&&(i=o);j=e[i],k=h[i][0],l=h[j][0],newCluster={left:k,right:l,dist:g[i][j],centroid:calculateCentroid(k.size,k.centroid,l.size,l.centroid),size:k.size+l.size,depth:1+Math.max(k.depth,l.depth)},h[i].splice(0,0,newCluster),f[i]+=f[j];for(p=0;p<d;p++)switch(b){case"single":g[i][p]>g[j][p]&&(g[p][i]=g[i][p]=g[j][p]);break;case"complete":g[i][p]<g[j][p]&&(g[p][i]=g[i][p]=g[j][p]);break;case"average":g[p][i]=g[i][p]=(f[i]*g[i][p]+f[j]*g[j][p])/(f[i]+f[p])}g[i][i]=Infinity;for(o=0;o<d;o++)g[o][j]=g[j][o]=Infinity;for(p=0;p<d;p++)e[p]==j&&(e[p]=i),g[i][p]<g[i][e[i]]&&(e[i]=p);n=newCluster}return n}var a=science.stats.distance.euclidean,b="simple";return c.distance=function(b){return arguments.length?(a=b,c):a},c},science.stats.iqr=function(a){var b=science.stats.quantiles(a,[.25,.75]);return b[1]-b[0]},science.stats.loess=function(){function d(d,e,f){var g=d.length,h;if(g!==e.length)throw{error:"Mismatched array lengths"};if(g==0)throw{error:"At least one point required."};if(arguments.length<3){f=[],h=-1;while(++h<g)f[h]=1}science_stats_loessFiniteReal(d),science_stats_loessFiniteReal(e),science_stats_loessFiniteReal(f),science_stats_loessStrictlyIncreasing(d);if(g==1)return[e[0]];if(g==2)return[e[0],e[1]];var i=Math.floor(a*g);if(i<2)throw{error:"Bandwidth too small."};var j=[],k=[],l=[];h=-1;while(++h<g)j[h]=0,k[h]=0,l[h]=1;var m=-1;while(++m<=b){var n=[0,i-1],o;h=-1;while(++h<g){o=d[h],h>0&&science_stats_loessUpdateBandwidthInterval(d,f,h,n);var p=n[0],q=n[1],r=d[h]-d[p]>d[q]-d[h]?p:q,s=0,t=0,u=0,v=0,w=0,x=Math.abs(1/(d[r]-o));for(var y=p;y<=q;++y){var z=d[y],A=e[y],B=y<h?o-z:z-o,C=science_stats_loessTricube(B*x)*l[y]*f[y],D=z*C;s+=C,t+=D,u+=z*D,v+=A*C,w+=A*D}var E=t/s,F=v/s,G=w/s,H=u/s,I=Math.sqrt(Math.abs(H-E*E))<c?0:(G-E*F)/(H-E*E),J=F-I*E;j[h]=I*o+J,k[h]=Math.abs(e[h]-j[h])}if(m===b)break;var K=k.slice();K.sort();var L=K[Math.floor(g/2)];if(Math.abs(L)<c)break;var M,C;h=-1;while(++h<g)M=k[h]/(6*L),l[h]=M>=1?0:(C=1-M*M)*C}return j}var a=.3,b=2,c=1e-12;return d.bandwidth=function(b){return arguments.length?(a=b,d):b},d.robustnessIterations=function(a){return arguments.length?(b=a,d):a},d.accuracy=function(a){return arguments.length?(c=a,d):a},d},science.stats.mean=function(a){var b=a.length;if(b===0)return NaN;var c=0,d=-1;while(++d<b)c+=(a[d]-c)/(d+1);return c},science.stats.median=function(a){return science.stats.quantiles(a,[.5])[0]},science.stats.mode=function(a){a=a.slice().sort(science.ascending);var b,c=a.length,d=-1,e=d,f=null,g=0,h,i;while(++d<c)(i=a[d])!==f&&((h=d-e)>g&&(g=h,b=f),f=i,e=d);return b},science.stats.quantiles=function(a,b){a=a.slice().sort(science.ascending);var c=a.length-1;return b.map(function(b){if(b===0)return a[0];if(b===1)return a[c];var e=1+b*c,f=Math.floor(e),g=e-f,h=a[f-1];return g===0?h:h+g*(a[f]-h)})},science.stats.variance=function(a){var b=a.length;if(b<1)return NaN;if(b===1)return 0;var c=science.stats.mean(a),d=-1,e=0;while(++d<b){var f=a[d]-c;e+=f*f}return e/(b-1)},science.stats.distribution={},science.stats.distribution.gaussian=function(){function e(){var d,e,f,g;do d=2*a()-1,e=2*a()-1,f=d*d+e*e;while(f>=1||f===0);return b+c*d*Math.sqrt(-2*Math.log(f)/f)}var a=Math.random,b=0,c=1,d=1;return e.pdf=function(a){return a=(a-mu)/c,science_stats_distribution_gaussianConstant*Math.exp(-0.5*a*a)/c},e.cdf=function(a){return a=(a-mu)/c,.5*(1+science.stats.erf(a/Math.SQRT2))},e.mean=function(a){return arguments.length?(b=+a,e):b},e.variance=function(a){return arguments.length?(c=Math.sqrt(d=+a),e):d},e.random=function(b){return arguments.length?(a=b,e):a},e},science_stats_distribution_gaussianConstant=1/Math.sqrt(2*Math.PI);